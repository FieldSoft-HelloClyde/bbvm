BBASM 概述
==========

字节码说明
----------
### 寻址方法

表示	| 字节码 | 说明
--------|-----|----
rx		| 0x0 | 寄存器寻址
[rx]	| 0x1 | 寄存器间接寻址
n		| 0x2 | 立即数寻址
[n]	| 0x3 | 间接寻址

### 两个操作数的寻址
 ----	|rx		| [rx]		| n	    | [n]
-------|------|------|------|----
rx		| 0x0	| 0x1	| 0x2	| 0x3
[rx]	| 0x4	| 0x5	| 0x6	| 0x7
n		| 0x8	| 0x9	| 0xa	| 0xb
[n]	| 0xc	| 0xd	| 0xe	| 0xf

### 寄存器类型

寄存器 | 机器码 | 说明
----|----|----
 rp | 0x0 |
 rf | 0x1 |
 rs | 0x2 |
 rb | 0x3 |
 r0 | 0x4 | #0 寄存器
 r1 | 0x5 | #1 寄存器
 r2 | 0x6 | #2 寄存器
 r3 | 0x7 | #3 寄存器

### 数据类型
 
数据类型|机器码
----|----
 dword	| 0x0
 word   | 0x1
 byte   | 0x2
 float  | 0x3
 int    | 0x4

### 算术类型

算术类型 | 机器码
----|----
 ADD	| 0x0
 SUB    | 0x1
 MUL    | 0x2
 DIV    | 0x3
 MOD    | 0x4

### 比较操作
比较操作 | 机器码 | 说明
--------|-------|----
 Z	| 0x1 | 等于
 B  | 0x2 | Below,小于
 BE | 0x3 | 小于等于
 A  | 0x4 | Above,大于
 AE | 0x5 | 大于等于
 NZ | 0x6 | 不等于
 
### 指令

指令 | 机器码 | 说明
----|-------|----
 NOP	| 0x0 | 无操作
 LD     | 0x1 | -
 PUSH   | 0x2 | 入栈
 POP    | 0x3 | 出栈
 IN     | 0x4 | -
 OUT    | 0x5 | -
 JMP    | 0x6 | -
 JPC    | 0x7 | -
 CALL   | 0x8 | 调用跳转
 RET    | 0x9 | 返回
 CMP    | 0xA | 比较
 CAL    | 0xB | 算术运算
 EXIT   | 0xF | 退出
 DATA   | n/a | 伪指令
 .BLOCK | n/a | 伪指令
 
 
* NOP,RET,EXIT 无操作数
* PUSH,POP,JMP,CALL 一个操作数
* LD,IN,OUT,CMP,CAL 两个操作数

指令的机器码构成
--------------
```
   指令码 + 数据类型 + 特殊用途字节 + 寻址方式 + 第一个操作数 + 第二个操作数
0x 0        0          0             0          0000           0000
```

* 无操作数的时候,寻址方式为0
* 无数据类型,数据类型为0
* CAL 使用特殊用途字节来指定算数类型
* JPC 比较特殊,数据类型为__比较操作__,该指令只有6个字节

IN 端口说明
----------

端口 | 功能 | 输入的数据(返回的值) | 参数列表 | 备注
----|----|----|----|----
0 | 浮点数转换为整数 | 整数 | r3:浮点数 | 
1 | 整数转换为浮点数 | 浮点数 | r3:整数 | 
2 | 申请字符串句柄 | 申请到的句柄 |  | 从-1开始查询
3 | 字符串转换为整数 | 整数 | r3:字符串句柄 | 若r3的值不是合法的字符串句柄则输入r3的值
4 | 整数转换为字符串 | r3的值 | r2:目标字符串（r2的内容实际上是字串句柄）<br>r3:整数 | r2所代表字符串的内容被修改
5 | 复制字符串 | r3的值 | r2:源字符串<br>r3:目标字符串 | r3所代表字符串的内容被修改
6 | 连接字符串 | r3的值 | r2:源字符串<br>r3:目标字符串 | r3所代表字符串的内容被修改 r3+r2
7 | 获取字符串长度 | 字符串长度 | r3:字符串 | 
8 | 释放字符串句柄 | r3的值 | r3:字符串句柄 | 
9 | 比较字符串 | 两字符串的差值 相同为0，不同为1 | r2:基准字符串<br>r3:比较字符串 | 
10 | 整数转换为浮点数再转换为字符串 | r3的值 | r2:目标字符串<br>r3:整数 | r2所代表字符串的内容被修改
11 | 字符串转换为浮点数 | 浮点数 | r3:字符串 | 
12 | 获取字符的ASCII码 | ASCII码 | r2:字符位置<br>r3:字符串 | 
13 | 求ASCII对应字符 | r3的值 | r1:ASCII码<br>r2:字符位置<br>r3:目标字符串 | r3所代表字符串的内容被修改
14 | （功用不明） | 65536 |  | 
15 | 获取嘀嗒计数 | 嘀嗒计数 |  | 
16 | 求正弦值 | X!的正弦值 | r3:X! | 
17 | 求余弦值 | X!的余弦值 | r3:X! | 
18 | 求正切值 | X!的正切值 | r3:X! | 
19 | 求平方根值 | X!的平方根值 | r3:X! | 
20 | 求绝对值 | X%的绝对值 | r3:X% | 
21 | 求绝对值 | X!的绝对值 | r3:X! | 
22 | 重定位数据指针 | r3的值 | r2:数据位置 | r3中为任意值
23 | 读内存数据 | 地址内容 | r3:地址 | 
24 | 写内存数据 | r3的值 | r2:待写入数据<br>r3:待写入地址 | 
25 | 获取环境值 | 环境值 |  | 
32 | 整数转换为字符串 | r3的值 | r1:整数<br>r3:目标字符串 | r3所代表字符串的内容被修改
33 | 字符串转换为整数 | 整数 | r3:字符串 | 
34 | 获取字符的ASCII码 | ASCII码 | r3:字符串 | 
35 | 左取字符串 | r3的值 | r1:截取长度<br>r2:源字符串<br>r3:目标字符串 | r3所代表字符串的内容被修改 （此端口似乎不正常） 
36 | 右取字符串 | r3的值 | r1:截取长度<br>r2:源字符串<br>r3:目标字符串 | r3所代表字符串的内容被修改
37 | 中间取字符串 | r3的值 | r0:截取长度<br>r1:截取位置<br>r2:源字符串<br>r3:目标字符串 | r3所代表字符串的内容被修改
38 | 查找字符串 | 位置 | r1:起始位置<br>r2:子字符串<br>r3:父字符串 | 
39 | 获取字符串长度 | 字符串长度 | r3:字符串 | 

OUT 端口说明
-----------

 端口 | 功能 | 输出的数据 | 参数列表 | 备注
-----|-----|-----|-----|-----
0 | 显示整数 | 整数 |  | 
1 | 显示字符串 | 字符串 |  | 
2 | 显示字符串 | 字符串 |  | 
3 | 显示整数 | 整数 |  | 
4 | 显示字符 | 字符ASCII码 |  | 
5 | 显示浮点数 | 浮点数 |  | 
10 | 键入整数 | 0 |  | r3的值变为键入的整数
11 | 键入字符串 | 0 | r3:目标字符串句柄 | r3所指字符串的内容变为键入的字符串
12 | 键入浮点数 | 0 |  | r3的值变为键入的浮点数
13 | 从数据区读取整数 | 0 |  | r3的值变为读取的整数
14 | 从数据区读取字符串 | 0 | r3:目标字符串句柄 | r3所指字符串的内容变为读取的字符串
15 | 从数据区读取浮点数 | 0 |  | r3的值变为读取的浮点数
16 | 设定模拟器屏幕 | 见库函数SetLcd
17 | 申请画布句柄 | 见库函数CreatPage
18 | 释放画布句柄 | 见库函数DeletePage
19 | 申请图片句柄并从文件载入像素资源 | 见库函数LoadRes
20 | 复制图片到画布上 | 见库函数ShowPic
21 | 显示画布 | 见库函数FlipPage
22 | 复制画布 | 见库函数BitBltPage
23 | 填充画布 | 见库函数FillPage
24 | 写入画布某点颜色 | 见库函数Pixel
25 | 读取画布某点颜色 | 见库函数ReadPixel
26 | 释放图片句柄 | 见库函数FreeRes
27 | 延迟一段时间 | 见库函数MsDelay
32 | 用种子初始化随机数生成器 | 见库函数Randomize
33 | 获取随机数 | 见库函数Rnd
34 | 判定某键是否按下 | 见库函数KeyPress
35 | 清屏 | 0 |  | 
36 | 按行列定位光标 | 见库函数Locate
37 | 设定文字颜色 | 见库函数Color
38 | 设定文字字体大小 | 见库函数Font
39 | 等待按键 | 见库函数WaitKey
40 | 获取图片宽度 | 见库函数GetPicWid
41 | 获取图片高度 | 见库函数GetPicHgt
42 | 按坐标定位光标 | 见库函数PixelLocate
43 | 复制部分画布 | 见库函数StretchBltPage
44 | 设定背景模式 | 见库函数SetBkMode
45 | 获取按键的字符串 | 见库函数InKey$
46 | 获取按键的ASCII码 | 见库函数InKey
48 | 打开文件 | 0 | r0:打开方式<br>r1:文件号<br>r3:文件名字符串 | 打开方式目前只能为1
49 | 关闭文件 | 文件号 |  | 
50 | 从文件读取数据 | 16:读取整数 | r1:文件号<br>r2:位置偏移量 | r3的值变为读取的整数
- |  | 17:读取浮点数 | r1:文件号<br>r2:位置偏移量 | r3的值变为读取的浮点数
- |  | 18:读取字符串 | r1:文件号<br>r2:位置偏移量<br>r3:目标字符串句柄 | r3所指字符串的内容变为读取的字符串
51 | 向文件写入数据 | 16:写入整数 | r1:文件号<br>r2:位置偏移量<br>r3:整数 | 
 - |  | 17:写入浮点数 | r1:文件号<br>r2:位置偏移量<br>r3:浮点数 | 
 |  | 18:写入字符串 | r1:文件号<br>r2:位置偏移量<br>r3:字符串 | 
52 | 判断文件位置指针是否指向文件尾 | 见库函数Eof
53 | 获取文件长度 | 见库函数Lof
54 | 获取文件位置指针的位置 | 见库函数Loc
55 | 定位文件位置指针 | 16 | r2:文件号<br>r3:目标位置 | 
64 | 设置画笔 | 见库函数SetPen
65 | 设置刷子 | 见库函数SetBrush
66 | 移动画笔 | 见库函数MoveTo
67 | 画线 | 见库函数LineTo
68 | 画矩形 | 见库函数Rectangle
69 | 画圆 | 见库函数Circle
80 | 复制部分画布扩展 | 见库函数StretchBltPageEx
255 | 虚拟机测试 | 见库函数VmTest

BB说明
======

BB 函数
-------
 
 
 
 
 


